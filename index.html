<!DOCTYPE html><html><head><title>Task Router on Servlets</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Task Router on Servlets"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Task Router on Servlets</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Give your customers specialized product support. Learn how to use TaskRouter to create a workflow that will redirect users to an appropriate sales agent, based on the product they select.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="TaskRouter Servlets" class="chapter"><div data-title="Application Overview" data-file="src/main/resources/workspace.json" class="step"><h2 id="application-overview">Application Overview</h2>
<p>In this tutorial we will show how to automate the routing of calls from
customers to your support agents. Customers will be able to select a
product and wait while TaskRouter tries to contact a product
specialist for the best support experience. If no one is available, our
application will save the customer&#39;s number and selected product so
an agent can call them back later on.</p>
<p>This is what the application does at a high level:</p>
<ol>
<li>Configure a workspace using the Twilio REST API.</li>
<li>Listen for incoming calls and let the user select a product with the dial pad.</li>
<li>Create a Task with the selected product and let TaskRouter handle it.</li>
<li>Store missed calls so agents can return the call to customers.</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//docs.oracle.com/javaee/6/tutorial/doc/bnafd.html">Getting Started with Servlets</a></li>
<li><a href="//www.twilio.com/docs/quickstart/java/taskrouter">Getting Started with Twilio TaskRouter</a></li>
</ul>
</div><div data-title="Configuring the Workspace" data-file="/src/main/resources/workspace.json" class="step"><h2 id="configuring-the-workspace">Configuring the Workspace</h2>
<p>In order to instruct TaskRouter to handle the Tasks, we need to
configure a Workspace. We can do this in the <a href="//www.twilio.com/console/taskrouter/workspaces">TaskRouter
Console</a> or
programmatically using the <a href="https://www.twilio.com/docs/api/taskrouter/rest-api">TaskRouter REST API</a>.</p>
<p>A <a href="https://www.twilio.com/docs/api/taskrouter/workspaces">Workspace</a> is the container element for any TaskRouter
application. The elements are:</p>
<ul>
<li><a href="https://www.twilio.com/docs/api/taskrouter/tasks">Tasks</a> - Represents a customer trying to contact an agent.</li>
<li><a href="https://www.twilio.com/docs/api/taskrouter/workers">Workers</a> - The agents responsible for handling Tasks.</li>
<li><a href="https://www.twilio.com/docs/api/taskrouter/taskqueues">Task Queues</a> - Holds Tasks to be consumed by a set of Workers.</li>
<li><a href="https://www.twilio.com/docs/api/taskrouter/workflows">Workflows</a> - Responsible for placing Tasks into Task Queues.</li>
<li><a href="https://www.twilio.com/docs/api/taskrouter/activities">Activities</a> - Possible states of a Worker, e.g. Idle,
Offline, Busy.</li>
</ul>
<p>In order to build a client for this API, we need as system variables a
<code>TWILIO_ACCOUNT_SID</code> and <code>TWILIO_AUTH_TOKEN</code> which you can find on <a href="//www.twilio.com/console">Twilio
Console</a>. The class <code>TwilioAppSettings</code>
creates a <code>TwilioTaskRouterClient</code>, which is provided by the
<a href="https://twilio.github.io/twilio-java">Twilio Java library</a>. This client is used by
[WorkspaceFacade]workspace-facade] which encapsulates all logic related to
the <code>Workspace</code> class.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://www.twilio.com/docs/api/taskrouter/rest-api">TaskRouter: REST API Reference</a></li>
<li><a href="https://twilio.github.io/twilio-java">TaskRouter: Java API Documentation</a></li>
</ul>
</div><div data-title="The CreateWorkspace Gradle Task" data-file="src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java" data-highlight="49-74,77-78,194-217" class="step"><h2 id="the-createworkspace-gradle-task">The CreateWorkspace Gradle Task</h2>
<p>In this application the <a href="https://docs.gradle.org/current/userguide/more_about_tasks.html">Gradle task</a> <code>createWorkspace</code> is used to
orchestrate calls to our <code>WorkspaceFacade</code> class in order to handle a Workspace.
<code>CreateWorkspaceTask</code> is the java main class behind the Gradle task.
It uses data provided by <code>workspace.json</code> and expects 3 arguments in the
following order:</p>
<ol>
<li><code>hostname</code> - A public URL to which Twilio can send requests. This can be
either a cloud service or <a href="//ngrok.com/docs">ngrok</a>, which can expose a local
application to the internet.</li>
<li><code>bobPhone</code> - The telephone number of Bob, the Programmable SMS specialist.</li>
<li><code>alicePhone</code> - Same for Alice, the Programmable Voice specialist.</li>
</ol>
<p>The function <code>createWorkspaceConfig</code> is used to load the
configuration of the workspace from <code>workspace.json</code>.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="https://docs.oracle.com/javase/tutorial/getStarted/application/">A Closer Look at the &quot;Hello World!&quot; Application</a></li>
<li><a href="https://docs.gradle.org/current/userguide/more_about_tasks.html">More about Gradle Tasks</a></li>
<li><a href="//ngrok.com/docs">Ngrok documentation</a></li>
<li><a href="//www.twilio.com/docs/quickstart/java/taskrouter">TaskRouter Java Quickstart Overview</a></li>
</ul>
</div><div data-title="Creating a Workspace" data-file="src/main/java/com/twilio/taskrouter/domain/model/WorkspaceFacade.java" data-highlight="46-63" class="step"><h1 id="creating-a-workspace">Creating a Workspace</h1>
<p>Before creating a workspace, we need to delete any others with the same
<code>FriendlyName</code> as identifier. In order to create a workspace we need
to provide a <code>FriendlyName</code>, and a <code>EventCallbackUrl</code> which contains an
URL to be called every time an event is triggered in the workspace.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/workspaces">TaskRouter REST API: Workspaces</a></li>
</ul>
</div><div data-title="Creating the Workers" data-file="src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java" data-highlight="64-65,80,91-108" class="step"><h1 id="creating-the-workers">Creating the Workers</h1>
<p>We&#39;ll create two workers, Bob and Alice. They each have two attributes:
<code>contact_uri</code> a phone number and <code>products</code>, a list of products
each worker is specialized in. We also need to specify an <code>activity_sid</code>
and a name for each worker. The selected activity will define the status
of the worker.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/workers">TaskRouter REST API: Workers</a></li>
</ul>
</div><div data-title="Creating the Task Queues" data-file="src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java" data-highlight="81,110-132" class="step"><h1 id="creating-the-task-queues">Creating the Task Queues</h1>
<p>Next, we set up the Task Queues. Each with a name and a <code>TargetWorkers</code> property,
which is an expression to match Workers. Our Task Queues are:</p>
<ol>
<li><code>SMS</code> - Will target Workers specialized in Programmable SMS, such
as Bob, using the expression <code>&quot;products HAS \&quot;ProgrammableSMS\&quot;&quot;</code>.</li>
<li><code>Voice</code> - Will do the same for Programmable Voice Workers, such
as Alice, using the expression <code>&quot;products HAS \&quot;ProgrammableVoice\&quot;&quot;</code>.</li>
<li><code>All</code> - This queue targets all users and can be used when there are
no specialist around for the chosen product. We can use the <code>&quot;1==1&quot;</code>
expression here.</li>
</ol>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/taskqueues">TaskRouter REST API: Task Queues</a></li>
<li><a href="//www.twilio.com/docs/api/taskrouter/taskqueues#target-workers">TargetWorkers&#39;s Expressions</a></li>
</ul>
</div><div data-title="Creating a Workflow" data-file="src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java" data-highlight="82,134-151" class="step"><h1 id="creating-a-workflow">Creating a Workflow</h1>
<p>Finally, we set up the Workflow using the following parameters:</p>
<ol>
<li><code>FriendlyName</code> as the name of a Workflow.</li>
<li><code>AssignmentCallbackUrl</code> as the public URL where a request will be made
when this Workflow assigns a Task to a Worker. We will learn how to
implement it on the next steps.</li>
<li><code>TaskReservationTimeout</code> as the maximum time we want to wait until a Worker
handles a Task.</li>
<li><code>configuration</code> which is a set of rules for placing Task into Task Queues.
The routing configuration will take a Task&#39;s attribute and match this with Task
Queues. This application&#39;s Workflow rules are defined as:<ol>
<li><code>selected_product==&quot;ProgrammableSMS&quot;</code> expression for <code>SMS</code> Task
Queue. This expression will match any Task with <code>ProgrammableSMS</code> as
the <code>selected_product</code> attribute.</li>
<li><code>selected_product==&quot;ProgrammableVoice</code> expression for <code>Voice</code>
Task Queue.</li>
</ol>
</li>
</ol>
</div></div><div data-title="Handling Twilio's Request" data-file="src/main/java/com/twilio/taskrouter/application/servlet/IncomingCallServlet.java" data-highlight="23-52" class="step"><h2 id="handling-twilio-s-request">Handling Twilio&#39;s Request</h2>
<p>Right after receiving a call, Twilio will send a request to the
URL specified on the <a href="//www.twilio.com/console/phone-numbers/incoming">number&#39;s configuration</a>.</p>
<p>The endpoint will then process the request and generate a TwiML response.
We&#39;ll use the <a href="//www.twilio.com/docs/api/twiml/say">Say</a> verb to give the user
product alternatives, and a key they can press in order to select one.
The <a href="//www.twilio.com/docs/api/twiml/gather">Gather</a> verb allows us to
capture the user&#39;s key press.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/platform/webhooks">Twilio webhooks</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/your_response">TwiML Voice: Your Response</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/say">TwiML Voice: &lt;Say&gt; verb</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/gather">TwiML Voice: &lt;Gather&gt; verb</a></li>
</ul>
</div><div data-title="Creating a Task" data-file="src/main/java/com/twilio/taskrouter/application/servlet/EnqueueServlet.java" data-highlight="26-62" class="step"><h2 id="creating-a-task">Creating a Task</h2>
<p>This is the endpoint set as the <code>action</code> URL on the <code>Gather</code> verb on the
previous step. A request is made to this endpoint when the user presses
a key during the call.
This request has a <code>Digits</code> parameter that holds the pressed keys.
A <code>Task</code> will be created based on the pressed digit with the
<code>selected_product</code> as an attribute. The Workflow will take this Task&#39;s
attributes and make a match with the <a href="//www.twilio.com/docs/api/taskrouter/expression-syntax">configured
expressions</a>
in order to find a corresponding Task Queue, so an appropriate available
Worker can be assigned to handle it.</p>
<p>We use the <a href="//www.twilio.com/docs/api/twiml/enqueue"><code>Enqueue</code> verb</a> with a <code>workflowSid</code> attribute
to <a href="//www.twilio.com/docs/api/taskrouter/twiml-integration#using-enqueue-to-route-calls-with-taskrouter">integrate with TaskRouter</a>. Then the voice call will
be put on hold while TaskRouter tries to find an available Worker to
handle this Task.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/twiml/twilio_request">TwiML Voice: Twilio&#39;s Request</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/gather#attributes-action-parameters">TwiML Voice: &lt;Gather&gt; callback attributes</a></li>
<li><a href="//www.twilio.com/docs/api/twiml/enqueue">TwiML Voice: &lt;Enqueue&gt; verb</a></li>
<li><a href="//www.twilio.com/docs/api/taskrouter/twiml-integration#using-enqueue-to-route-calls-with-taskrouter">TaskRouter: Using &lt;Enqueue&gt; to route calls with TaskRouter</a></li>
</ul>
</div><div data-title="Assigning a Worker" data-file="src/main/java/com/twilio/taskrouter/application/servlet/AssignmentServlet.java" data-highlight="18-36" class="step"><h2 id="assigning-a-worker">Assigning a Worker</h2>
<p>When TaskRouter selects a Worker, it does the following:</p>
<ol>
<li><p>The Task&#39;s Assignment Status is set to <code>reserved</code>.</p>
</li>
<li><p>A <a href="//www.twilio.com/docs/api/taskrouter/reservations">Reservation instance</a> is generated,
linking the Task to the selected Worker.</p>
</li>
<li><p>At the same time the Reservation is created, a POST request is
made to the Workflow&#39;s AssignmentCallbackURL, which was configured using
the Gradle task <a href="https://github.com/TwilioDevEd/task-router-servlets/blob/master/src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java"><code>createWorkspace</code></a>.</p>
</li>
</ol>
<p>This request includes the full details of the Task, the selected Worker,
and the Reservation.</p>
<p>Handling this <a href="//www.twilio.com/docs/api/taskrouter/handling-assignment-callbacks">Assignment Callback</a> is a key
component of building a TaskRouter application as we can instruct how the
Worker will handle a Task. We could send a text, e-mail, push
notifications or make a call.</p>
<p>Since we created this Task during a voice call with an <code>Enqueue</code> verb,
lets <a href="//www.twilio.com/docs/api/taskrouter/handling-assignment-callbacks#dequeue-call">instruct TaskRouter to dequeue</a> the call and dial
a Worker. If we do not specify a <code>to</code> parameter with a
phone number, TaskRouter will pick the Worker&#39;s <code>contact_uri</code> attribute.</p>
<p>We also send a <code>post_work_activity_sid</code> which will tell TaskRouter which
<a href="//www.twilio.com/docs/quickstart/ruby/taskrouter/setup-understanding-activities">Activity</a> to assign this worker after the call ends.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/handling-assignment-callbacks">Assigning Tasks to Workers: Handling Assignment Callbacks</a></li>
<li><a href="//www.twilio.com/docs/api/taskrouter/handling-assignment-callbacks#dequeue-call">Assigning Tasks to Workers: Dequeue a call from a TwiML queue</a></li>
<li><a href="//www.twilio.com/docs/quickstart/java/taskrouter/setup-understanding-activities">TaskRouter Quickstart: Understanding Activities</a></li>
</ul>
</div><div data-title="Collecting Missed Calls" data-file="src/main/java/com/twilio/taskrouter/application/servlet/EventsServlet.java" data-highlight="49-98" class="step"><h2 id="collecting-missed-calls">Collecting Missed Calls</h2>
<p>This endpoint will be called after each <a href="//www.twilio.com/docs/api/taskrouter/events#event-types">TaskRouter Event</a>
is triggered. In our application, we are trying to collect missed calls,
so we would like to handle the <code>workflow.timeout</code> event. This event is
triggered when the Task waits more than the limit set on Workflow
Configuration-- or rather when no worker is available.</p>
<p>Here we use TwilioRestClient to route this call to a <a href="//www.twilio.com/labs/twimlets/voicemail">Voicemail
Twimlet</a>. Twimlets are tiny web applications for
voice.  This one will generate a <code>TwiML</code> response using <code>Say</code> verb and
record a message using <code>Record</code> verb. The recorded message will then be
transcribed and sent to the email address configured.</p>
<p>We are also listening for <code>task.canceled</code>. This is triggered
when the customer hangs up before being assigned to an agent, therefore
canceling the task. Capturing this event allows us to collect the
information from the customers that hang up before the Workflow times out.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/events">TaskRouter: Events</a></li>
<li><a href="//www.twilio.com/docs/api/taskrouter/events#event-types">TaskRouter: Event types</a></li>
<li><a href="//www.twilio.com/labs/twimlets">Twilio Twimlets</a></li>
</ul>
</div><div data-title="Changing a Worker's Activity" data-file="src/main/java/com/twilio/taskrouter/application/servlet/MessageServlet.java" data-highlight="24-63" class="step"><h2 id="changing-a-worker-s-activity">Changing a Worker&#39;s Activity</h2>
<p>We have created this endpoint, so a worker can send an SMS message to the
support line with the command &quot;On&quot; or &quot;Off&quot; to change their availability
status.</p>
<p>This is important as a worker&#39;s activity will change to <code>Offline</code> when
they miss a call. When this happens, they receive an SMS letting them know
that their activity has changed, and that they can reply with the <code>On</code>
command to make themselves available for incoming calls again.</p>
<hr>
<p><strong>See Also:</strong></p>
<ul>
<li><a href="//www.twilio.com/docs/api/taskrouter/events">TaskRouter: Events</a></li>
<li><a href="//www.twilio.com/docs/api/taskrouter/events#event-types">TaskRouter: Event types</a></li>
</ul>
</div><div class="step"><h2 id="where-to-next-">Where to Next?</h2>
<p>That&#39;s it!</p>
<p>If you&#39;re a Java developer working with Twilio, you might enjoy these
other tutorials:</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/click-to-call/java/servlets"><strong>Click to Call</strong></a></p>
<p>An example application implementing Click to Call using Twilio.</p>
<p><a href="//www.twilio.com/docs/tutorials/walkthrough/automated-survey/java/servlets"><strong>Automated-Survey-Servlets</strong></a></p>
<p>Instantly collect structured data from your users with a survey conducted
over a call or SMS text messages.</p>
<p>Thanks for checking this tutorial out! If you have any feedback
to share with us, we&#39;d love to hear it.
<a href="mailto:deved-oss@twilio.com">Contact the Twilio Developer Education Team</a>
to let us know what you think.</p>
</div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="src/main/resources/workspace.json" data-mode="json">ewogICJuYW1lIjogIlR3aWxpbyBXb3Jrc3BhY2UiLAogICJldmVudF9jYWxsYmFjayI6ICIlKGhvc3Qpcy9ldmVudHMiLAogICJ3b3JrZXJzIjogWwogICAgewogICAgICAibmFtZSI6ICJCb2IiLAogICAgICAiYXR0cmlidXRlcyI6IHsKICAgICAgICAicHJvZHVjdHMiOiBbCiAgICAgICAgICAiUHJvZ3JhbW1hYmxlU01TIgogICAgICAgIF0sCiAgICAgICAgImNvbnRhY3RfdXJpIjogIiUoYm9iX251bWJlcilzIgogICAgICB9CiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJBbGljZSIsCiAgICAgICJhdHRyaWJ1dGVzIjogewogICAgICAgICJwcm9kdWN0cyI6IFsKICAgICAgICAgICJQcm9ncmFtbWFibGVWb2ljZSIKICAgICAgICBdLAogICAgICAgICJjb250YWN0X3VyaSI6ICIlKGFsaWNlX251bWJlcilzIgogICAgICB9CiAgICB9CiAgXSwKICAiYWN0aXZpdGllcyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiT2ZmbGluZSIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJJZGxlIiwKICAgICAgImF2YWlsYWJpbGl0eSI6ICJ0cnVlIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQnVzeSIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZXNlcnZlZCIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9CiAgXSwKICAidGFza19xdWV1ZXMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIkRlZmF1bHQiLAogICAgICAidGFyZ2V0V29ya2VycyI6ICIxPT0xIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU01TIiwKICAgICAgInRhcmdldFdvcmtlcnMiOiAicHJvZHVjdHMgSEFTIFwiUHJvZ3JhbW1hYmxlU01TXCIiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJWb2ljZSIsCiAgICAgICJ0YXJnZXRXb3JrZXJzIjogInByb2R1Y3RzIEhBUyBcIlByb2dyYW1tYWJsZVZvaWNlXCIiCiAgICB9CiAgXSwKICAid29ya2Zsb3ciOiB7CiAgICAibmFtZSI6ICJTYWxlcyIsCiAgICAiY2FsbGJhY2siOiAiJShob3N0KXMvYXNzaWdubWVudCIsCiAgICAidGltZW91dCI6ICIxNSIsCiAgICAicm91dGluZ0NvbmZpZ3VyYXRpb24iOiBbCiAgICAgIHsKICAgICAgICAiZXhwcmVzc2lvbiI6ICJzZWxlY3RlZF9wcm9kdWN0PT1cIlByb2dyYW1tYWJsZVNNU1wiIiwKICAgICAgICAidGFyZ2V0VGFza1F1ZXVlIjogIlNNUyIKICAgICAgfSwKICAgICAgewogICAgICAgICJleHByZXNzaW9uIjogInNlbGVjdGVkX3Byb2R1Y3Q9PVwiUHJvZ3JhbW1hYmxlVm9pY2VcIiIsCiAgICAgICAgInRhcmdldFRhc2tRdWV1ZSI6ICJWb2ljZSIKICAgICAgfQogICAgXQogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="/src/main/resources/workspace.json" data-mode="json">ewogICJuYW1lIjogIlR3aWxpbyBXb3Jrc3BhY2UiLAogICJldmVudF9jYWxsYmFjayI6ICIlKGhvc3Qpcy9ldmVudHMiLAogICJ3b3JrZXJzIjogWwogICAgewogICAgICAibmFtZSI6ICJCb2IiLAogICAgICAiYXR0cmlidXRlcyI6IHsKICAgICAgICAicHJvZHVjdHMiOiBbCiAgICAgICAgICAiUHJvZ3JhbW1hYmxlU01TIgogICAgICAgIF0sCiAgICAgICAgImNvbnRhY3RfdXJpIjogIiUoYm9iX251bWJlcilzIgogICAgICB9CiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJBbGljZSIsCiAgICAgICJhdHRyaWJ1dGVzIjogewogICAgICAgICJwcm9kdWN0cyI6IFsKICAgICAgICAgICJQcm9ncmFtbWFibGVWb2ljZSIKICAgICAgICBdLAogICAgICAgICJjb250YWN0X3VyaSI6ICIlKGFsaWNlX251bWJlcilzIgogICAgICB9CiAgICB9CiAgXSwKICAiYWN0aXZpdGllcyI6IFsKICAgIHsKICAgICAgIm5hbWUiOiAiT2ZmbGluZSIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJJZGxlIiwKICAgICAgImF2YWlsYWJpbGl0eSI6ICJ0cnVlIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiQnVzeSIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJSZXNlcnZlZCIsCiAgICAgICJhdmFpbGFiaWxpdHkiOiAiZmFsc2UiCiAgICB9CiAgXSwKICAidGFza19xdWV1ZXMiOiBbCiAgICB7CiAgICAgICJuYW1lIjogIkRlZmF1bHQiLAogICAgICAidGFyZ2V0V29ya2VycyI6ICIxPT0xIgogICAgfSwKICAgIHsKICAgICAgIm5hbWUiOiAiU01TIiwKICAgICAgInRhcmdldFdvcmtlcnMiOiAicHJvZHVjdHMgSEFTIFwiUHJvZ3JhbW1hYmxlU01TXCIiCiAgICB9LAogICAgewogICAgICAibmFtZSI6ICJWb2ljZSIsCiAgICAgICJ0YXJnZXRXb3JrZXJzIjogInByb2R1Y3RzIEhBUyBcIlByb2dyYW1tYWJsZVZvaWNlXCIiCiAgICB9CiAgXSwKICAid29ya2Zsb3ciOiB7CiAgICAibmFtZSI6ICJTYWxlcyIsCiAgICAiY2FsbGJhY2siOiAiJShob3N0KXMvYXNzaWdubWVudCIsCiAgICAidGltZW91dCI6ICIxNSIsCiAgICAicm91dGluZ0NvbmZpZ3VyYXRpb24iOiBbCiAgICAgIHsKICAgICAgICAiZXhwcmVzc2lvbiI6ICJzZWxlY3RlZF9wcm9kdWN0PT1cIlByb2dyYW1tYWJsZVNNU1wiIiwKICAgICAgICAidGFyZ2V0VGFza1F1ZXVlIjogIlNNUyIKICAgICAgfSwKICAgICAgewogICAgICAgICJleHByZXNzaW9uIjogInNlbGVjdGVkX3Byb2R1Y3Q9PVwiUHJvZ3JhbW1hYmxlVm9pY2VcIiIsCiAgICAgICAgInRhcmdldFRhc2tRdWV1ZSI6ICJWb2ljZSIKICAgICAgfQogICAgXQogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/CreateWorkspaceTask.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb247CgppbXBvcnQgY29tLmdvb2dsZS5pbmplY3QuR3VpY2U7CmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5JbmplY3RvcjsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5BY3Rpdml0eTsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5UYXNrUXVldWU7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuV29ya2Zsb3c7CmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuV29ya2Zsb3dSdWxlOwppbXBvcnQgY29tLnR3aWxpby50YXNrcm91dGVyLldvcmtmbG93UnVsZVRhcmdldDsKaW1wb3J0IGNvbS50d2lsaW8udGFza3JvdXRlci5kb21haW4uY29tbW9uLlR3aWxpb0FwcFNldHRpbmdzOwppbXBvcnQgY29tLnR3aWxpby50YXNrcm91dGVyLmRvbWFpbi5jb21tb24uVXRpbHM7CmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLmVycm9yLlRhc2tSb3V0ZXJFeGNlcHRpb247CmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLm1vZGVsLldvcmtzcGFjZUZhY2FkZTsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nMy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nMy50ZXh0LlN0clN1YnN0aXR1dG9yOwoKaW1wb3J0IGphdmF4Lmpzb24uSnNvbjsKaW1wb3J0IGphdmF4Lmpzb24uSnNvbkFycmF5OwppbXBvcnQgamF2YXguanNvbi5Kc29uT2JqZWN0OwppbXBvcnQgamF2YXguanNvbi5Kc29uUmVhZGVyOwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uU3RyaW5nUmVhZGVyOwppbXBvcnQgamF2YS5uZXQuVVJJU3ludGF4RXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuVVJMOwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk9wdGlvbmFsOwppbXBvcnQgamF2YS51dGlsLlByb3BlcnRpZXM7CmltcG9ydCBqYXZhLnV0aWwubG9nZ2luZy5Mb2dnZXI7CmltcG9ydCBqYXZhLnV0aWwuc3RyZWFtLkNvbGxlY3RvcnM7CgppbXBvcnQgc3RhdGljIGphdmEubGFuZy5TeXN0ZW0uZXhpdDsKCi8vaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5sYW5nMy5TdHJpbmdVdGlsczsKLy9pbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxhbmczLnRleHQuU3RyU3Vic3RpdHV0b3I7CgovKioKICogQ3JlYXRlcyBhIHdvcmtzcGFjZQogKi8KY2xhc3MgQ3JlYXRlV29ya3NwYWNlVGFzayB7CgogIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0TG9nZ2VyKENyZWF0ZVdvcmtzcGFjZVRhc2suY2xhc3MuZ2V0TmFtZSgpKTsKCiAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewoKICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ3JlYXRpbmcgd29ya3NwYWNlLi4uIik7CiAgICBpZiAoYXJncy5sZW5ndGggPCAzKSB7CiAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiWW91IG11c3Qgc3BlY2lmeSAzIHBhcmFtZXRlcnM6Iik7CiAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiLSBTZXJ2ZXIgaG9zdG5hbWUuIEUuZywgPGhhc2g+Lm5ncm9rLmNvbSIpOwogICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIi0gUGhvbmUgb2YgdGhlIGZpcnN0IGFnZW50IChCb2IpIik7CiAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiLSBQaG9uZSBvZiB0aGUgc2Vjb25kYXJ5IGFnZW50IChBbGljZSkiKTsKICAgICAgZXhpdCgxKTsKICAgIH0KCiAgICBTdHJpbmcgaG9zdG5hbWUgPSBhcmdzWzBdOwogICAgU3RyaW5nIGJvYlBob25lID0gYXJnc1sxXTsKICAgIFN0cmluZyBhbGljZVBob25lID0gYXJnc1syXTsKICAgIFN5c3RlbS5vdXQucHJpbnRsbihTdHJpbmcuZm9ybWF0KCJTZXJ2ZXI6ICVzXG5Cb2IgcGhvbmU6ICVzXG5BbGljZSBwaG9uZTogJXNcbiIsCiAgICAgIGhvc3RuYW1lLCBib2JQaG9uZSwgYWxpY2VQaG9uZSkpOwoKICAgIC8vR2V0IHRoZSBjb25maWd1cmF0aW9uCiAgICBKc29uT2JqZWN0IHdvcmtzcGFjZUNvbmZpZyA9IGNyZWF0ZVdvcmtzcGFjZUNvbmZpZyhhcmdzKTsKCiAgICAvL0dldCBvciBDcmVhdGUgdGhlIFdvcmtzcGFjZQogICAgSW5qZWN0b3IgaW5qZWN0b3IgPSBHdWljZS5jcmVhdGVJbmplY3RvcigpOwogICAgZmluYWwgVHdpbGlvQXBwU2V0dGluZ3MgdHdpbGlvU2V0dGluZ3MgPSBpbmplY3Rvci5nZXRJbnN0YW5jZShUd2lsaW9BcHBTZXR0aW5ncy5jbGFzcyk7CgogICAgU3RyaW5nIHdvcmtzcGFjZU5hbWUgPSB3b3Jrc3BhY2VDb25maWcuZ2V0U3RyaW5nKCJuYW1lIik7CiAgICBNYXA8U3RyaW5nLCBTdHJpbmc+IHdvcmtzcGFjZVBhcmFtcyA9IG5ldyBIYXNoTWFwPD4oKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoIkZyaWVuZGx5TmFtZSIsIHdvcmtzcGFjZU5hbWUpOwogICAgd29ya3NwYWNlUGFyYW1zLnB1dCgiRXZlbnRDYWxsYmFja1VybCIsIHdvcmtzcGFjZUNvbmZpZy5nZXRTdHJpbmcoImV2ZW50X2NhbGxiYWNrIikpOwoKICAgIHRyeSB7CiAgICAgIFdvcmtzcGFjZUZhY2FkZSB3b3Jrc3BhY2VGYWNhZGUgPSBXb3Jrc3BhY2VGYWNhZGUKICAgICAgICAuY3JlYXRlKHR3aWxpb1NldHRpbmdzLmdldFR3aWxpb1Jlc3RDbGllbnQoKSwgd29ya3NwYWNlUGFyYW1zKTsKCiAgICAgIGFkZFdvcmtlcnNUb1dvcmtzcGFjZSh3b3Jrc3BhY2VGYWNhZGUsIHdvcmtzcGFjZUNvbmZpZyk7CiAgICAgIGFkZFRhc2tRdWV1ZXNUb1dvcmtzcGFjZSh3b3Jrc3BhY2VGYWNhZGUsIHdvcmtzcGFjZUNvbmZpZyk7CiAgICAgIFdvcmtmbG93IHdvcmtmbG93ID0gYWRkV29ya2Zsb3dUb1dvcmtzcGFjZSh3b3Jrc3BhY2VGYWNhZGUsIHdvcmtzcGFjZUNvbmZpZyk7CgogICAgICBwcmludFN1Y2Nlc3NBbmRFeHBvcnRWYXJpYWJsZXMod29ya3NwYWNlRmFjYWRlLCB3b3JrZmxvdywgdHdpbGlvU2V0dGluZ3MpOwogICAgfSBjYXRjaCAoVGFza1JvdXRlckV4Y2VwdGlvbiBlKSB7CiAgICAgIExPRy5zZXZlcmUoZS5nZXRNZXNzYWdlKCkpOwogICAgICBleGl0KDEpOwogICAgfQogIH0KCiAgcHVibGljIHN0YXRpYyB2b2lkIGFkZFdvcmtlcnNUb1dvcmtzcGFjZShXb3Jrc3BhY2VGYWNhZGUgd29ya3NwYWNlRmFjYWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSnNvbk9iamVjdCB3b3Jrc3BhY2VKc29uQ29uZmlnKSB7CiAgICBKc29uQXJyYXkgd29ya2Vyc0pzb24gPSB3b3Jrc3BhY2VKc29uQ29uZmlnLmdldEpzb25BcnJheSgid29ya2VycyIpOwogICAgQWN0aXZpdHkgaWRsZUFjdGl2aXR5ID0gd29ya3NwYWNlRmFjYWRlLmdldElkbGVBY3Rpdml0eSgpOwoKICAgIHdvcmtlcnNKc29uLmdldFZhbHVlc0FzKEpzb25PYmplY3QuY2xhc3MpLmZvckVhY2god29ya2VySnNvbiAtPiB7CiAgICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gd29ya2VyUGFyYW1zID0gbmV3IEhhc2hNYXA8PigpOwogICAgICB3b3JrZXJQYXJhbXMucHV0KCJGcmllbmRseU5hbWUiLCB3b3JrZXJKc29uLmdldFN0cmluZygibmFtZSIpKTsKICAgICAgd29ya2VyUGFyYW1zLnB1dCgiQWN0aXZpdHlTaWQiLCBpZGxlQWN0aXZpdHkuZ2V0U2lkKCkpOwogICAgICB3b3JrZXJQYXJhbXMucHV0KCJBdHRyaWJ1dGVzIiwgd29ya2VySnNvbi5nZXRKc29uT2JqZWN0KCJhdHRyaWJ1dGVzIikudG9TdHJpbmcoKSk7CgogICAgICB0cnkgewogICAgICAgIHdvcmtzcGFjZUZhY2FkZS5hZGRXb3JrZXIod29ya2VyUGFyYW1zKTsKICAgICAgfSBjYXRjaCAoVGFza1JvdXRlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgTE9HLndhcm5pbmcoZS5nZXRNZXNzYWdlKCkpOwogICAgICB9CiAgICB9KTsKICB9CgogIHB1YmxpYyBzdGF0aWMgdm9pZCBhZGRUYXNrUXVldWVzVG9Xb3Jrc3BhY2UoV29ya3NwYWNlRmFjYWRlIHdvcmtzcGFjZUZhY2FkZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpzb25PYmplY3Qgd29ya3NwYWNlSnNvbkNvbmZpZykgewogICAgSnNvbkFycmF5IHRhc2tRdWV1ZXNKc29uID0gd29ya3NwYWNlSnNvbkNvbmZpZy5nZXRKc29uQXJyYXkoInRhc2tfcXVldWVzIik7CiAgICBBY3Rpdml0eSByZXNlcnZhdGlvbkFjdGl2aXR5ID0gd29ya3NwYWNlRmFjYWRlLmZpbmRBY3Rpdml0eUJ5TmFtZSgiUmVzZXJ2ZWQiKS5vckVsc2VUaHJvdygoKSAtPgogICAgICBuZXcgVGFza1JvdXRlckV4Y2VwdGlvbigiVGhlIGFjdGl2aXR5IGZvciByZXNlcnZhdGlvbnMgJ1Jlc2VydmVkJyB3YXMgbm90IGZvdW5kLiAiCiAgICAgICAgKyAiVGFza1F1ZXVlcyBjYW5ub3QgYmUgYWRkZWQuIikpOwogICAgQWN0aXZpdHkgYXNzaWdubWVudEFjdGl2aXR5ID0gd29ya3NwYWNlRmFjYWRlLmZpbmRBY3Rpdml0eUJ5TmFtZSgiQnVzeSIpLm9yRWxzZVRocm93KCgpIC0+CiAgICAgIG5ldyBUYXNrUm91dGVyRXhjZXB0aW9uKCJUaGUgYWN0aXZpdHkgZm9yIGFzc2lnbm1lbnRzICdCdXN5JyB3YXMgbm90IGZvdW5kLiAiCiAgICAgICAgKyAiVGFza1F1ZXVlcyBjYW5ub3QgYmUgYWRkZWQuIikpOwogICAgdGFza1F1ZXVlc0pzb24uZ2V0VmFsdWVzQXMoSnNvbk9iamVjdC5jbGFzcykuZm9yRWFjaCh0YXNrUXVldWVKc29uIC0+IHsKICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiB0YXNrUXVldWVQYXJhbXMgPSBuZXcgSGFzaE1hcDw+KCk7CiAgICAgIHRhc2tRdWV1ZVBhcmFtcy5wdXQoIkZyaWVuZGx5TmFtZSIsIHRhc2tRdWV1ZUpzb24uZ2V0U3RyaW5nKCJuYW1lIikpOwogICAgICB0YXNrUXVldWVQYXJhbXMucHV0KCJUYXJnZXRXb3JrZXJzIiwgdGFza1F1ZXVlSnNvbi5nZXRTdHJpbmcoInRhcmdldFdvcmtlcnMiKSk7CiAgICAgIHRhc2tRdWV1ZVBhcmFtcy5wdXQoIlJlc2VydmF0aW9uQWN0aXZpdHlTaWQiLCByZXNlcnZhdGlvbkFjdGl2aXR5LmdldFNpZCgpKTsKICAgICAgdGFza1F1ZXVlUGFyYW1zLnB1dCgiQXNzaWdubWVudEFjdGl2aXR5U2lkIiwgYXNzaWdubWVudEFjdGl2aXR5LmdldFNpZCgpKTsKCiAgICAgIHRyeSB7CiAgICAgICAgd29ya3NwYWNlRmFjYWRlLmFkZFRhc2tRdWV1ZSh0YXNrUXVldWVQYXJhbXMpOwogICAgICB9IGNhdGNoIChUYXNrUm91dGVyRXhjZXB0aW9uIGUpIHsKICAgICAgICBMT0cud2FybmluZyhlLmdldE1lc3NhZ2UoKSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcHVibGljIHN0YXRpYyBXb3JrZmxvdyBhZGRXb3JrZmxvd1RvV29ya3NwYWNlKFdvcmtzcGFjZUZhY2FkZSB3b3Jrc3BhY2VGYWNhZGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEpzb25PYmplY3Qgd29ya3NwYWNlQ29uZmlnKSB7CiAgICBKc29uT2JqZWN0IHdvcmtmbG93SnNvbiA9IHdvcmtzcGFjZUNvbmZpZy5nZXRKc29uT2JqZWN0KCJ3b3JrZmxvdyIpOwogICAgU3RyaW5nIHdvcmtmbG93TmFtZSA9IHdvcmtmbG93SnNvbi5nZXRTdHJpbmcoIm5hbWUiKTsKICAgIHJldHVybiB3b3Jrc3BhY2VGYWNhZGUuZmluZFdvcmtmbG93QnlOYW1lKHdvcmtmbG93TmFtZSkKICAgICAgLm9yRWxzZUdldCgoKSAtPiB7CiAgICAgICAgTWFwPFN0cmluZywgU3RyaW5nPiB3b3JrZmxvd1BhcmFtcyA9IG5ldyBIYXNoTWFwPD4oKTsKICAgICAgICB3b3JrZmxvd1BhcmFtcy5wdXQoIkZyaWVuZGx5TmFtZSIsIHdvcmtmbG93TmFtZSk7CiAgICAgICAgd29ya2Zsb3dQYXJhbXMucHV0KCJBc3NpZ25tZW50Q2FsbGJhY2tVcmwiLCB3b3JrZmxvd0pzb24uZ2V0U3RyaW5nKCJjYWxsYmFjayIpKTsKICAgICAgICB3b3JrZmxvd1BhcmFtcy5wdXQoIkZhbGxiYWNrQXNzaWdubWVudENhbGxiYWNrVXJsIiwgd29ya2Zsb3dKc29uLmdldFN0cmluZygiY2FsbGJhY2siKSk7CiAgICAgICAgd29ya2Zsb3dQYXJhbXMucHV0KCJUYXNrUmVzZXJ2YXRpb25UaW1lb3V0Iiwgd29ya2Zsb3dKc29uLmdldFN0cmluZygidGltZW91dCIpKTsKCiAgICAgICAgU3RyaW5nIHdvcmtmbG93Q29uZmlnSnNvbiA9IGNyZWF0ZVdvcmtGbG93SnNvbkNvbmZpZyh3b3Jrc3BhY2VGYWNhZGUsIHdvcmtmbG93SnNvbik7CiAgICAgICAgd29ya2Zsb3dQYXJhbXMucHV0KCJDb25maWd1cmF0aW9uIiwgd29ya2Zsb3dDb25maWdKc29uKTsKCiAgICAgICAgcmV0dXJuIHdvcmtzcGFjZUZhY2FkZS5hZGRXb3JrZmxvdyh3b3JrZmxvd1BhcmFtcyk7CiAgICAgIH0pOwogIH0KCiAgcHVibGljIHN0YXRpYyB2b2lkIHByaW50U3VjY2Vzc0FuZEV4cG9ydFZhcmlhYmxlcyhXb3Jrc3BhY2VGYWNhZGUgd29ya3NwYWNlRmFjYWRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV29ya2Zsb3cgd29ya2Zsb3csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2lsaW9BcHBTZXR0aW5ncyB0d2lsaW9TZXR0aW5ncykgewogICAgQWN0aXZpdHkgaWRsZUFjdGl2aXR5ID0gd29ya3NwYWNlRmFjYWRlLmdldElkbGVBY3Rpdml0eSgpOwoKICAgIFByb3BlcnRpZXMgd29ya3NwYWNlUGFyYW1zID0gbmV3IFByb3BlcnRpZXMoKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoImFjY291bnQuc2lkIiwgdHdpbGlvU2V0dGluZ3MuZ2V0VHdpbGlvQWNjb3VudFNpZCgpKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoImF1dGgudG9rZW4iLCB0d2lsaW9TZXR0aW5ncy5nZXRUd2lsaW9BdXRoVG9rZW4oKSk7CiAgICB3b3Jrc3BhY2VQYXJhbXMucHV0KCJ3b3Jrc3BhY2Uuc2lkIiwgd29ya3NwYWNlRmFjYWRlLmdldFNpZCgpKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoIndvcmtmbG93LnNpZCIsIHdvcmtmbG93LmdldFNpZCgpKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoInBvc3RXb3JrQWN0aXZpdHkuc2lkIiwgaWRsZUFjdGl2aXR5LmdldFNpZCgpKTsKICAgIHdvcmtzcGFjZVBhcmFtcy5wdXQoImVtYWlsIiwgdHdpbGlvU2V0dGluZ3MuZ2V0RW1haWwoKSk7CiAgICB3b3Jrc3BhY2VQYXJhbXMucHV0KCJwaG9uZU51bWJlciIsIHR3aWxpb1NldHRpbmdzLmdldFBob25lTnVtYmVyKCkudG9TdHJpbmcoKSk7CgogICAgRmlsZSB3b3Jrc3BhY2VQcm9wZXJ0aWVzRmlsZSA9IG5ldyBGaWxlKFR3aWxpb0FwcFNldHRpbmdzLldPUktTUEFDRV9QUk9QRVJUSUVTX0ZJTEVfUEFUSCk7CgogICAgdHJ5IHsKICAgICAgVXRpbHMuc2F2ZVByb3BlcnRpZXMod29ya3NwYWNlUGFyYW1zLAogICAgICAgIHdvcmtzcGFjZVByb3BlcnRpZXNGaWxlLAogICAgICAgICJQcm9wZXJ0aWVzIGZvciBsYXN0IGNyZWF0ZWQgVHdpbGlvIFRhc2tSb3V0ZXIgd29ya3NwYWNlIik7CiAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgIExPRy5zZXZlcmUoIkNvdWxkIG5vdCBzYXZlIHdvcmtzcGFjZS5wcm9wZXJ0aWVzIHdpdGggY3VycmVudCBjb25maWd1cmF0aW9uIik7CiAgICAgIGV4aXQoMSk7CiAgICB9CgogICAgU3RyaW5nIHN1Y2Nlc3NNc2cgPSBTdHJpbmcuZm9ybWF0KCJXb3Jrc3BhY2UgJyVzJyB3YXMgY3JlYXRlZCBzdWNjZXNzZnVsbHkuIiwKICAgICAgd29ya3NwYWNlRmFjYWRlLmdldEZyaWVuZGx5TmFtZSgpKTsKICAgIGZpbmFsIGludCBsaW5lTGVuZ3RoID0gc3VjY2Vzc01zZy5sZW5ndGgoKSArIDI7CgogICAgU3lzdGVtLm91dC5wcmludGxuKFN0cmluZ1V0aWxzLnJlcGVhdCgiIyIsIGxpbmVMZW5ndGgpKTsKICAgIFN5c3RlbS5vdXQucHJpbnRsbihTdHJpbmcuZm9ybWF0KCIgJXMgIiwgc3VjY2Vzc01zZykpOwogICAgU3lzdGVtLm91dC5wcmludGxuKFN0cmluZ1V0aWxzLnJlcGVhdCgiIyIsIGxpbmVMZW5ndGgpKTsKICAgIFN5c3RlbS5vdXQucHJpbnRsbigiVGhlIGZvbGxvd2luZyB2YXJpYWJsZXMgd2VyZSByZWdpc3RlcmVkOiIpOwogICAgU3lzdGVtLm91dC5wcmludGxuKCJcbiIpOwogICAgd29ya3NwYWNlUGFyYW1zLmVudHJ5U2V0KCkuc3RyZWFtKCkuZm9yRWFjaChwcm9wZXJ0eUVudHJ5IC0+IHsKICAgICAgU3lzdGVtLm91dC5wcmludGxuKFN0cmluZy5mb3JtYXQoIiVzPSVzIiwgcHJvcGVydHlFbnRyeS5nZXRLZXkoKSwgcHJvcGVydHlFbnRyeS5nZXRWYWx1ZSgpKSk7CiAgICB9KTsKICAgIFN5c3RlbS5vdXQucHJpbnRsbigiXG4iKTsKICAgIFN5c3RlbS5vdXQucHJpbnRsbihTdHJpbmdVdGlscy5yZXBlYXQoIiMiLCBsaW5lTGVuZ3RoKSk7CiAgfQoKICBwdWJsaWMgc3RhdGljIEpzb25PYmplY3QgY3JlYXRlV29ya3NwYWNlQ29uZmlnKFN0cmluZ1tdIGFyZ3MpIHsKICAgIGZpbmFsIFN0cmluZyBjb25maWdGaWxlTmFtZSA9ICJ3b3Jrc3BhY2UuanNvbiI7CgogICAgT3B0aW9uYWw8VVJMPiB1cmwgPQogICAgICBPcHRpb25hbC5vZk51bGxhYmxlKENyZWF0ZVdvcmtzcGFjZVRhc2suY2xhc3MuZ2V0UmVzb3VyY2UoRmlsZS5zZXBhcmF0b3IgKyBjb25maWdGaWxlTmFtZSkpOwogICAgcmV0dXJuIHVybC5tYXAodSAtPiB7CiAgICAgIHRyeSB7CiAgICAgICAgRmlsZSB3b3Jrc3BhY2VDb25maWdKc29uRmlsZSA9IG5ldyBGaWxlKHUudG9VUkkoKSk7CiAgICAgICAgU3RyaW5nIGpzb25Db250ZW50ID0gVXRpbHMucmVhZEZpbGVDb250ZW50KHdvcmtzcGFjZUNvbmZpZ0pzb25GaWxlKTsKICAgICAgICBTdHJpbmcgcGFyc2VkQ29udGVudCA9IHBhcnNlV29ya3NwYWNlSnNvbkNvbnRlbnQoanNvbkNvbnRlbnQsIGFyZ3MpOwoKICAgICAgICB0cnkgKEpzb25SZWFkZXIganNvblJlYWRlciA9IEpzb24uY3JlYXRlUmVhZGVyKG5ldyBTdHJpbmdSZWFkZXIocGFyc2VkQ29udGVudCkpKSB7CiAgICAgICAgICByZXR1cm4ganNvblJlYWRlci5yZWFkT2JqZWN0KCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChVUklTeW50YXhFeGNlcHRpb24gZSkgewogICAgICAgIHRocm93IG5ldyBUYXNrUm91dGVyRXhjZXB0aW9uKFN0cmluZy5mb3JtYXQoIldyb25nIHVyaSB0byBmaW5kICVzOiAlcyIsCiAgICAgICAgICBjb25maWdGaWxlTmFtZSwgZS5nZXRNZXNzYWdlKCkpKTsKICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgIHRocm93IG5ldyBUYXNrUm91dGVyRXhjZXB0aW9uKFN0cmluZy5mb3JtYXQoIkVycm9yIHdoaWxlIHJlYWRpbmcgJXM6ICVzIiwKICAgICAgICAgIGNvbmZpZ0ZpbGVOYW1lLCBlLmdldE1lc3NhZ2UoKSkpOwogICAgICB9CiAgICB9KS5vckVsc2VUaHJvdygKICAgICAgKCkgLT4gbmV3IFRhc2tSb3V0ZXJFeGNlcHRpb24oIlRoZXJlJ3Mgbm8gdmFsaWQgY29uZmlndXJhdGlvbiBpbiAiICsgY29uZmlnRmlsZU5hbWUpKTsKICB9CgogIHByaXZhdGUgc3RhdGljIFN0cmluZyBwYXJzZVdvcmtzcGFjZUpzb25Db250ZW50KGZpbmFsIFN0cmluZyB1bnBhcnNlZENvbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgU3RyaW5nLi4uIGFyZ3MpIHsKICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gdmFsdWVzID0gbmV3IEhhc2hNYXA8PigpOwogICAgdmFsdWVzLnB1dCgiaG9zdCIsIGFyZ3NbMF0pOwogICAgdmFsdWVzLnB1dCgiYm9iX251bWJlciIsIGFyZ3NbMV0pOwogICAgdmFsdWVzLnB1dCgiYWxpY2VfbnVtYmVyIiwgYXJnc1syXSk7CgogICAgU3RyU3Vic3RpdHV0b3Igc3RyU3Vic3RpdHV0b3IgPSBuZXcgU3RyU3Vic3RpdHV0b3IodmFsdWVzLCAiJSgiLCAiKXMiKTsKICAgIHJldHVybiBzdHJTdWJzdGl0dXRvci5yZXBsYWNlKHVucGFyc2VkQ29udGVudCk7CiAgfQoKICBwdWJsaWMgc3RhdGljIFN0cmluZyBjcmVhdGVXb3JrRmxvd0pzb25Db25maWcoV29ya3NwYWNlRmFjYWRlIHdvcmtzcGFjZUZhY2FkZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSnNvbk9iamVjdCB3b3JrZmxvd0pzb24pIHsKICAgIHRyeSB7CiAgICAgIEpzb25BcnJheSByb3V0aW5nQ29uZmlnUnVsZXMgPSB3b3JrZmxvd0pzb24uZ2V0SnNvbkFycmF5KCJyb3V0aW5nQ29uZmlndXJhdGlvbiIpOwogICAgICBUYXNrUXVldWUgZGVmYXVsdFF1ZXVlID0gd29ya3NwYWNlRmFjYWRlLmZpbmRUYXNrUXVldWVCeU5hbWUoIkRlZmF1bHQiKQogICAgICAgIC5vckVsc2VUaHJvdygoKSAtPiBuZXcgVGFza1JvdXRlckV4Y2VwdGlvbigiRGVmYXVsdCBxdWV1ZSBub3QgZm91bmQiKSk7CiAgICAgIFdvcmtmbG93UnVsZVRhcmdldCBkZWZhdWx0UnVsZVRhcmdldCA9IG5ldyBXb3JrZmxvd1J1bGVUYXJnZXQuQnVpbGRlcihkZWZhdWx0UXVldWUuZ2V0U2lkKCkpCiAgICAgICAgLmV4cHJlc3Npb24oIjE9MSIpCiAgICAgICAgLnByaW9yaXR5KDEpCiAgICAgICAgLnRpbWVvdXQoMzApCiAgICAgICAgLmJ1aWxkKCk7CgogICAgICBMaXN0PFdvcmtmbG93UnVsZT4gcnVsZXMgPSByb3V0aW5nQ29uZmlnUnVsZXMuZ2V0VmFsdWVzQXMoSnNvbk9iamVjdC5jbGFzcykuc3RyZWFtKCkKICAgICAgICAubWFwKHJ1bGVKc29uIC0+IHsKICAgICAgICAgIFN0cmluZyBydWxlUXVldWVOYW1lID0gcnVsZUpzb24uZ2V0U3RyaW5nKCJ0YXJnZXRUYXNrUXVldWUiKTsKICAgICAgICAgIFRhc2tRdWV1ZSBydWxlUXVldWUgPSB3b3Jrc3BhY2VGYWNhZGUuZmluZFRhc2tRdWV1ZUJ5TmFtZShydWxlUXVldWVOYW1lKS5vckVsc2VUaHJvdygKICAgICAgICAgICAgKCkgLT4gbmV3IFRhc2tSb3V0ZXJFeGNlcHRpb24oU3RyaW5nLmZvcm1hdCgiJXMgcXVldWUgbm90IGZvdW5kIiwgcnVsZVF1ZXVlTmFtZSkpKTsKCiAgICAgICAgICBXb3JrZmxvd1J1bGVUYXJnZXQgcXVldWVSdWxlVGFyZ2V0ID0gbmV3IFdvcmtmbG93UnVsZVRhcmdldC5CdWlsZGVyKHJ1bGVRdWV1ZS5nZXRTaWQoKSkKICAgICAgICAgICAgLnByaW9yaXR5KDUpCiAgICAgICAgICAgIC50aW1lb3V0KDMwKQogICAgICAgICAgICAuYnVpbGQoKTsKCiAgICAgICAgICBMaXN0PFdvcmtmbG93UnVsZVRhcmdldD4gcnVsZVRhcmdldHMgPSBBcnJheXMuYXNMaXN0KHF1ZXVlUnVsZVRhcmdldCwgZGVmYXVsdFJ1bGVUYXJnZXQpOwoKICAgICAgICAgIHJldHVybiBuZXcgV29ya2Zsb3dSdWxlLkJ1aWxkZXIocnVsZUpzb24uZ2V0U3RyaW5nKCJleHByZXNzaW9uIiksIHJ1bGVUYXJnZXRzKS5idWlsZCgpOwogICAgICAgIH0pLmNvbGxlY3QoQ29sbGVjdG9ycy50b0xpc3QoKSk7CgogICAgICBjb20udHdpbGlvLnRhc2tyb3V0ZXIuV29ya2Zsb3cgY29uZmlnOwogICAgICBjb25maWcgPSBuZXcgY29tLnR3aWxpby50YXNrcm91dGVyLldvcmtmbG93KHJ1bGVzLCBkZWZhdWx0UnVsZVRhcmdldCk7CiAgICAgIHJldHVybiBjb25maWcudG9Kc29uKCk7CiAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAgdGhyb3cgbmV3IFRhc2tSb3V0ZXJFeGNlcHRpb24oIkVycm9yIHdoaWxlIGNyZWF0aW5nIHdvcmtmbG93IGpzb24gY29uZmlndXJhdGlvbiIsIGV4KTsKICAgIH0KICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/domain/model/WorkspaceFacade.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLm1vZGVsOwoKaW1wb3J0IGNvbS5mYXN0ZXJ4bWwuamFja3Nvbi5kYXRhYmluZC5PYmplY3RNYXBwZXI7CmltcG9ydCBjb20udHdpbGlvLmJhc2UuUmVzb3VyY2VTZXQ7CmltcG9ydCBjb20udHdpbGlvLmh0dHAuVHdpbGlvUmVzdENsaWVudDsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLldvcmtzcGFjZTsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLldvcmtzcGFjZUNyZWF0b3I7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS5Xb3Jrc3BhY2VEZWxldGVyOwppbXBvcnQgY29tLnR3aWxpby5yZXN0LnRhc2tyb3V0ZXIudjEuV29ya3NwYWNlRmV0Y2hlcjsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLldvcmtzcGFjZVJlYWRlcjsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5BY3Rpdml0eTsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5BY3Rpdml0eVJlYWRlcjsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5UYXNrUXVldWU7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuVGFza1F1ZXVlQ3JlYXRvcjsKaW1wb3J0IGNvbS50d2lsaW8ucmVzdC50YXNrcm91dGVyLnYxLndvcmtzcGFjZS5UYXNrUXVldWVSZWFkZXI7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuV29ya2VyOwppbXBvcnQgY29tLnR3aWxpby5yZXN0LnRhc2tyb3V0ZXIudjEud29ya3NwYWNlLldvcmtlckNyZWF0b3I7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuV29ya2VyUmVhZGVyOwppbXBvcnQgY29tLnR3aWxpby5yZXN0LnRhc2tyb3V0ZXIudjEud29ya3NwYWNlLldvcmtlclVwZGF0ZXI7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuV29ya2Zsb3c7CmltcG9ydCBjb20udHdpbGlvLnJlc3QudGFza3JvdXRlci52MS53b3Jrc3BhY2UuV29ya2Zsb3dDcmVhdG9yOwppbXBvcnQgY29tLnR3aWxpby5yZXN0LnRhc2tyb3V0ZXIudjEud29ya3NwYWNlLldvcmtmbG93UmVhZGVyOwppbXBvcnQgY29tLnR3aWxpby50YXNrcm91dGVyLmRvbWFpbi5lcnJvci5UYXNrUm91dGVyRXhjZXB0aW9uOwoKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuT3B0aW9uYWw7CmltcG9ydCBqYXZhLnV0aWwuc3RyZWFtLlN0cmVhbVN1cHBvcnQ7CgpwdWJsaWMgY2xhc3MgV29ya3NwYWNlRmFjYWRlIHsKCiAgcHJpdmF0ZSBmaW5hbCBUd2lsaW9SZXN0Q2xpZW50IGNsaWVudDsKCiAgcHJpdmF0ZSBmaW5hbCBXb3Jrc3BhY2Ugd29ya3NwYWNlOwoKICBwcml2YXRlIEFjdGl2aXR5IGlkbGVBY3Rpdml0eTsKCiAgcHJpdmF0ZSBNYXA8U3RyaW5nLCBXb3JrZXI+IHBob25lVG9Xb3JrZXI7CgogIHB1YmxpYyBXb3Jrc3BhY2VGYWNhZGUoVHdpbGlvUmVzdENsaWVudCBjbGllbnQsIFdvcmtzcGFjZSB3b3Jrc3BhY2UpIHsKICAgIHRoaXMuY2xpZW50ID0gY2xpZW50OwogICAgdGhpcy53b3Jrc3BhY2UgPSB3b3Jrc3BhY2U7CiAgfQoKICBwdWJsaWMgc3RhdGljIFdvcmtzcGFjZUZhY2FkZSBjcmVhdGUoVHdpbGlvUmVzdENsaWVudCBjbGllbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hcDxTdHJpbmcsIFN0cmluZz4gcGFyYW1zKSB7CiAgICBTdHJpbmcgd29ya3NwYWNlTmFtZSA9IHBhcmFtcy5nZXQoIkZyaWVuZGx5TmFtZSIpOwogICAgU3RyaW5nIGV2ZW50Q2FsbGJhY2tVcmwgPSBwYXJhbXMuZ2V0KCJFdmVudENhbGxiYWNrVXJsIik7CgogICAgUmVzb3VyY2VTZXQ8V29ya3NwYWNlPiBleGVjdXRlID0gbmV3IFdvcmtzcGFjZVJlYWRlcigpCiAgICAgIC5ieUZyaWVuZGx5TmFtZSh3b3Jrc3BhY2VOYW1lKQogICAgICAuZXhlY3V0ZShjbGllbnQpOwogICAgU3RyZWFtU3VwcG9ydC5zdHJlYW0oZXhlY3V0ZS5zcGxpdGVyYXRvcigpLCBmYWxzZSkKICAgICAgLmZpbmRGaXJzdCgpCiAgICAgIC5pZlByZXNlbnQod29ya3NwYWNlIC0+IG5ldyBXb3Jrc3BhY2VEZWxldGVyKHdvcmtzcGFjZS5nZXRTaWQoKSkuZXhlY3V0ZShjbGllbnQpKTsKCiAgICBXb3Jrc3BhY2Ugd29ya3NwYWNlID0gbmV3IFdvcmtzcGFjZUNyZWF0b3Iod29ya3NwYWNlTmFtZSkKICAgICAgLnNldEV2ZW50Q2FsbGJhY2tVcmwoZXZlbnRDYWxsYmFja1VybCkKICAgICAgLmV4ZWN1dGUoY2xpZW50KTsKCiAgICByZXR1cm4gbmV3IFdvcmtzcGFjZUZhY2FkZShjbGllbnQsIHdvcmtzcGFjZSk7CiAgfQoKICBwdWJsaWMgc3RhdGljIE9wdGlvbmFsPFdvcmtzcGFjZUZhY2FkZT4gZmluZEJ5U2lkKFN0cmluZyB3b3Jrc3BhY2VTaWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUd2lsaW9SZXN0Q2xpZW50IGNsaWVudCkgewogICAgV29ya3NwYWNlIHdvcmtzcGFjZSA9IG5ldyBXb3Jrc3BhY2VGZXRjaGVyKHdvcmtzcGFjZVNpZCkuZXhlY3V0ZShjbGllbnQpOwogICAgcmV0dXJuIE9wdGlvbmFsLm9mKG5ldyBXb3Jrc3BhY2VGYWNhZGUoY2xpZW50LCB3b3Jrc3BhY2UpKTsKICB9CgogIHB1YmxpYyBTdHJpbmcgZ2V0RnJpZW5kbHlOYW1lKCkgewogICAgcmV0dXJuIHdvcmtzcGFjZS5nZXRGcmllbmRseU5hbWUoKTsKICB9CgogIHB1YmxpYyBTdHJpbmcgZ2V0U2lkKCkgewogICAgcmV0dXJuIHdvcmtzcGFjZS5nZXRTaWQoKTsKICB9CgogIHB1YmxpYyBXb3JrZXIgYWRkV29ya2VyKE1hcDxTdHJpbmcsIFN0cmluZz4gd29ya2VyUGFyYW1zKSB7CiAgICByZXR1cm4gbmV3IFdvcmtlckNyZWF0b3Iod29ya3NwYWNlLmdldFNpZCgpLCB3b3JrZXJQYXJhbXMuZ2V0KCJGcmllbmRseU5hbWUiKSkKICAgICAgLnNldEFjdGl2aXR5U2lkKHdvcmtlclBhcmFtcy5nZXQoIkFjdGl2aXR5U2lkIikpCiAgICAgIC5zZXRBdHRyaWJ1dGVzKHdvcmtlclBhcmFtcy5nZXQoIkF0dHJpYnV0ZXMiKSkKICAgICAgLmV4ZWN1dGUoY2xpZW50KTsKICB9CgogIHB1YmxpYyB2b2lkIGFkZFRhc2tRdWV1ZShNYXA8U3RyaW5nLCBTdHJpbmc+IHRhc2tRdWV1ZVBhcmFtcykgewogICAgbmV3IFRhc2tRdWV1ZUNyZWF0b3IodGhpcy53b3Jrc3BhY2UuZ2V0U2lkKCksCiAgICAgIHRhc2tRdWV1ZVBhcmFtcy5nZXQoIkZyaWVuZGx5TmFtZSIpLAogICAgICB0YXNrUXVldWVQYXJhbXMuZ2V0KCJSZXNlcnZhdGlvbkFjdGl2aXR5U2lkIiksCiAgICAgIHRhc2tRdWV1ZVBhcmFtcy5nZXQoIkFzc2lnbm1lbnRBY3Rpdml0eVNpZCIpKQogICAgICAuZXhlY3V0ZShjbGllbnQpOwogIH0KCiAgcHVibGljIFdvcmtmbG93IGFkZFdvcmtmbG93KE1hcDxTdHJpbmcsIFN0cmluZz4gd29ya2Zsb3dQYXJhbXMpIHsKICAgIHJldHVybiBuZXcgV29ya2Zsb3dDcmVhdG9yKHdvcmtzcGFjZS5nZXRTaWQoKSwKICAgICAgd29ya2Zsb3dQYXJhbXMuZ2V0KCJGcmllbmRseU5hbWUiKSwKICAgICAgd29ya2Zsb3dQYXJhbXMuZ2V0KCJDb25maWd1cmF0aW9uIikpCiAgICAgIC5zZXRBc3NpZ25tZW50Q2FsbGJhY2tVcmwod29ya2Zsb3dQYXJhbXMuZ2V0KCJBc3NpZ25tZW50Q2FsbGJhY2tVcmwiKSkKICAgICAgLnNldEZhbGxiYWNrQXNzaWdubWVudENhbGxiYWNrVXJsKHdvcmtmbG93UGFyYW1zLmdldCgiRmFsbGJhY2tBc3NpZ25tZW50Q2FsbGJhY2tVcmwiKSkKICAgICAgLnNldFRhc2tSZXNlcnZhdGlvblRpbWVvdXQoSW50ZWdlci52YWx1ZU9mKHdvcmtmbG93UGFyYW1zLmdldCgiVGFza1Jlc2VydmF0aW9uVGltZW91dCIpKSkKICAgICAgLmV4ZWN1dGUoY2xpZW50KTsKICB9CgogIHB1YmxpYyBPcHRpb25hbDxBY3Rpdml0eT4gZmluZEFjdGl2aXR5QnlOYW1lKFN0cmluZyBhY3Rpdml0eU5hbWUpIHsKICAgIHJldHVybiBTdHJlYW1TdXBwb3J0LnN0cmVhbShuZXcgQWN0aXZpdHlSZWFkZXIodGhpcy53b3Jrc3BhY2UuZ2V0U2lkKCkpCiAgICAgIC5ieUZyaWVuZGx5TmFtZShhY3Rpdml0eU5hbWUpCiAgICAgIC5leGVjdXRlKGNsaWVudCkuc3BsaXRlcmF0b3IoKSwgZmFsc2UKICAgICkuZmluZEZpcnN0KCk7CiAgfQoKICBwdWJsaWMgT3B0aW9uYWw8VGFza1F1ZXVlPiBmaW5kVGFza1F1ZXVlQnlOYW1lKFN0cmluZyBxdWV1ZU5hbWUpIHsKICAgIHJldHVybiBTdHJlYW1TdXBwb3J0LnN0cmVhbShuZXcgVGFza1F1ZXVlUmVhZGVyKHRoaXMud29ya3NwYWNlLmdldFNpZCgpKQogICAgICAuYnlGcmllbmRseU5hbWUocXVldWVOYW1lKQogICAgICAuZXhlY3V0ZShjbGllbnQpLnNwbGl0ZXJhdG9yKCksIGZhbHNlCiAgICApLmZpbmRGaXJzdCgpOwogIH0KCiAgcHVibGljIE9wdGlvbmFsPFdvcmtmbG93PiBmaW5kV29ya2Zsb3dCeU5hbWUoU3RyaW5nIHdvcmtmbG93TmFtZSkgewogICAgcmV0dXJuIFN0cmVhbVN1cHBvcnQuc3RyZWFtKG5ldyBXb3JrZmxvd1JlYWRlcih0aGlzLndvcmtzcGFjZS5nZXRTaWQoKSkKICAgICAgLmJ5RnJpZW5kbHlOYW1lKHdvcmtmbG93TmFtZSkKICAgICAgLmV4ZWN1dGUoY2xpZW50KS5zcGxpdGVyYXRvcigpLCBmYWxzZQogICAgKS5maW5kRmlyc3QoKTsKICB9CgogIHB1YmxpYyBPcHRpb25hbDxXb3JrZXI+IGZpbmRXb3JrZXJCeVBob25lKFN0cmluZyB3b3JrZXJQaG9uZSkgewogICAgcmV0dXJuIE9wdGlvbmFsLm9mTnVsbGFibGUoZ2V0UGhvbmVUb1dvcmtlcigpLmdldCh3b3JrZXJQaG9uZSkpOwogIH0KCiAgcHVibGljIE1hcDxTdHJpbmcsIFdvcmtlcj4gZ2V0UGhvbmVUb1dvcmtlcigpIHsKICAgIGlmIChwaG9uZVRvV29ya2VyID09IG51bGwpIHsKICAgICAgcGhvbmVUb1dvcmtlciA9IG5ldyBIYXNoTWFwPD4oKTsKICAgICAgU3RyZWFtU3VwcG9ydC5zdHJlYW0oCiAgICAgICAgbmV3IFdvcmtlclJlYWRlcih0aGlzLndvcmtzcGFjZS5nZXRTaWQoKSkuZXhlY3V0ZShjbGllbnQpLnNwbGl0ZXJhdG9yKCksIGZhbHNlCiAgICAgICkuZm9yRWFjaCh3b3JrZXIgLT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBIYXNoTWFwPFN0cmluZywgT2JqZWN0PiBhdHRyaWJ1dGVzID0gbmV3IE9iamVjdE1hcHBlcigpCiAgICAgICAgICAgIC5yZWFkVmFsdWUod29ya2VyLmdldEF0dHJpYnV0ZXMoKSwgSGFzaE1hcC5jbGFzcyk7CiAgICAgICAgICBwaG9uZVRvV29ya2VyLnB1dChhdHRyaWJ1dGVzLmdldCgiY29udGFjdF91cmkiKS50b1N0cmluZygpLCB3b3JrZXIpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgIHRocm93IG5ldyBUYXNrUm91dGVyRXhjZXB0aW9uKAogICAgICAgICAgICBTdHJpbmcuZm9ybWF0KCInJXMnIGhhcyBhIG1hbGZvcm1lZCBqc29uIGF0dHJpYnV0ZXMiLCB3b3JrZXIuZ2V0RnJpZW5kbHlOYW1lKCkpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHBob25lVG9Xb3JrZXI7CiAgfQoKICBwdWJsaWMgQWN0aXZpdHkgZ2V0SWRsZUFjdGl2aXR5KCkgewogICAgaWYgKGlkbGVBY3Rpdml0eSA9PSBudWxsKSB7CiAgICAgIGlkbGVBY3Rpdml0eSA9IGZpbmRBY3Rpdml0eUJ5TmFtZSgiSWRsZSIpLmdldCgpOwogICAgfQogICAgcmV0dXJuIGlkbGVBY3Rpdml0eTsKICB9CgogIHB1YmxpYyB2b2lkIHVwZGF0ZVdvcmtlclN0YXR1cyhXb3JrZXIgd29ya2VyLCBTdHJpbmcgYWN0aXZpdHlGcmllbmRseU5hbWUpIHsKICAgIEFjdGl2aXR5IGFjdGl2aXR5ID0gZmluZEFjdGl2aXR5QnlOYW1lKGFjdGl2aXR5RnJpZW5kbHlOYW1lKS5vckVsc2VUaHJvdygoKSAtPgogICAgICBuZXcgVGFza1JvdXRlckV4Y2VwdGlvbigKICAgICAgICBTdHJpbmcuZm9ybWF0KCJUaGUgYWN0aXZpdHkgJyVzJyBkb2Vzbid0IGV4aXN0IGluIHRoZSB3b3Jrc3BhY2UiLCBhY3Rpdml0eUZyaWVuZGx5TmFtZSkKICAgICAgKQogICAgKTsKCiAgICBuZXcgV29ya2VyVXBkYXRlcih3b3Jrc3BhY2UuZ2V0U2lkKCksIHdvcmtlci5nZXRTaWQoKSkKICAgICAgLnNldEFjdGl2aXR5U2lkKGFjdGl2aXR5LmdldFNpZCgpKQogICAgICAuZXhlY3V0ZShjbGllbnQpOwogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/servlet/IncomingCallServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb24uc2VydmxldDsKCgppbXBvcnQgY29tLnR3aWxpby50d2ltbC5HYXRoZXI7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLk1ldGhvZDsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuU2F5OwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Ud2lNTEV4Y2VwdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuVm9pY2VSZXNwb25zZTsKCmltcG9ydCBqYXZheC5pbmplY3QuU2luZ2xldG9uOwppbXBvcnQgamF2YXguc2VydmxldC5TZXJ2bGV0RXhjZXB0aW9uOwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwppbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwoKLyoqCiAqIFJldHVybnMgVHdpTUwgaW5zdHJ1Y3Rpb25zIHRvIFR3aWxpb0FwcFNldHRpbmdzJ3MgUE9TVCByZXF1ZXN0cwogKi8KQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgSW5jb21pbmdDYWxsU2VydmxldCBleHRlbmRzIEh0dHBTZXJ2bGV0IHsKCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlci5nZXRMb2dnZXIoSW5jb21pbmdDYWxsU2VydmxldC5jbGFzcy5nZXROYW1lKCkpOwoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBkb1Bvc3QoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcSwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwKSB0aHJvd3MgU2VydmxldEV4Y2VwdGlvbiwKICAgIElPRXhjZXB0aW9uIHsKICAgIHRyeSB7CiAgICAgIGZpbmFsIFZvaWNlUmVzcG9uc2UgdHdpbWxSZXNwb25zZSA9IG5ldyBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIoKQogICAgICAgIC5nYXRoZXIobmV3IEdhdGhlci5CdWlsZGVyKCkKICAgICAgICAgIC5hY3Rpb24oIi9jYWxsL2VucXVldWUiKQogICAgICAgICAgLm51bURpZ2l0cygxKQogICAgICAgICAgLnRpbWVvdXQoMTApCiAgICAgICAgICAubWV0aG9kKE1ldGhvZC5QT1NUKQogICAgICAgICAgLnNheShuZXcgU2F5CiAgICAgICAgICAgIC5CdWlsZGVyKCJGb3IgUHJvZ3JhbW1hYmxlIFNNUywgcHJlc3Mgb25lLiBGb3IgVm9pY2UsIHByZXNzIGFueSBvdGhlciBrZXkuIikKICAgICAgICAgICAgLmJ1aWxkKCkKICAgICAgICAgICkKICAgICAgICAgIC5idWlsZCgpCiAgICAgICAgKS5idWlsZCgpOwoKICAgICAgcmVzcC5zZXRDb250ZW50VHlwZSgiYXBwbGljYXRpb24veG1sIik7CiAgICAgIHJlc3AuZ2V0V3JpdGVyKCkucHJpbnQodHdpbWxSZXNwb25zZS50b1htbCgpKTsKICAgIH0gY2F0Y2ggKFR3aU1MRXhjZXB0aW9uIGUpIHsKICAgICAgTE9HLmxvZyhMZXZlbC5TRVZFUkUsICJVbmV4cGVjdGVkIGVycm9yIHdoaWxlIGNyZWF0aW5nIGluY29taW5nIGNhbGwgcmVzcG9uc2UiLCBlKTsKICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7CiAgICB9CiAgfQoKfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/servlet/EnqueueServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb24uc2VydmxldDsKCmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLmNvbW1vbi5Ud2lsaW9BcHBTZXR0aW5nczsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuRW5xdWV1ZVRhc2s7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLlRhc2s7CmltcG9ydCBjb20udHdpbGlvLnR3aW1sLlR3aU1MRXhjZXB0aW9uOwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Wb2ljZVJlc3BvbnNlOwoKaW1wb3J0IGphdmF4LmluamVjdC5JbmplY3Q7CmltcG9ydCBqYXZheC5pbmplY3QuU2luZ2xldG9uOwppbXBvcnQgamF2YXguc2VydmxldC5TZXJ2bGV0RXhjZXB0aW9uOwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5PcHRpb25hbDsKaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwppbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwoKaW1wb3J0IHN0YXRpYyBqYXZhLmxhbmcuU3RyaW5nLmZvcm1hdDsKCi8qKgogKiBTZWxlY3RzIGEgcHJvZHVjdCBieSBjcmVhdGluZyBhIFRhc2sgb24gdGhlIFRhc2tSb3V0ZXIgV29ya2Zsb3cKICovCkBTaW5nbGV0b24KcHVibGljIGNsYXNzIEVucXVldWVTZXJ2bGV0IGV4dGVuZHMgSHR0cFNlcnZsZXQgewoKICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyLmdldExvZ2dlcihFbnF1ZXVlU2VydmxldC5jbGFzcy5nZXROYW1lKCkpOwoKICBwcml2YXRlIGZpbmFsIFN0cmluZyB3b3JrZmxvd1NpZDsKCiAgQEluamVjdAogIHB1YmxpYyBFbnF1ZXVlU2VydmxldChUd2lsaW9BcHBTZXR0aW5ncyB0d2lsaW9TZXR0aW5ncykgewogICAgdGhpcy53b3JrZmxvd1NpZCA9IHR3aWxpb1NldHRpbmdzLmdldFdvcmtmbG93U2lkKCk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBkb1Bvc3QoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcSwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwKQogICAgdGhyb3dzIFNlcnZsZXRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKCiAgICBTdHJpbmcgc2VsZWN0ZWRQcm9kdWN0ID0gZ2V0U2VsZWN0ZWRQcm9kdWN0KHJlcSk7CiAgICBUYXNrIHRhc2sgPSBuZXcgVGFzay5CdWlsZGVyKCkKICAgICAgLmRhdGEoZm9ybWF0KCJ7XCJzZWxlY3RlZF9wcm9kdWN0XCI6IFwiJXNcIn0iLCBzZWxlY3RlZFByb2R1Y3QpKQogICAgICAuYnVpbGQoKTsKCiAgICBFbnF1ZXVlVGFzayBlbnF1ZXVlVGFzayA9IG5ldyBFbnF1ZXVlVGFzay5CdWlsZGVyKHRhc2spLndvcmtmbG93U2lkKHdvcmtmbG93U2lkKS5idWlsZCgpOwoKICAgIFZvaWNlUmVzcG9uc2Ugdm9pY2VSZXNwb25zZSA9IG5ldyBWb2ljZVJlc3BvbnNlLkJ1aWxkZXIoKS5lbnF1ZXVlKGVucXVldWVUYXNrKS5idWlsZCgpOwogICAgcmVzcC5zZXRDb250ZW50VHlwZSgiYXBwbGljYXRpb24veG1sIik7CiAgICB0cnkgewogICAgICByZXNwLmdldFdyaXRlcigpLnByaW50KHZvaWNlUmVzcG9uc2UudG9YbWwoKSk7CiAgICB9IGNhdGNoIChUd2lNTEV4Y2VwdGlvbiBlKSB7CiAgICAgIExPRy5sb2coTGV2ZWwuU0VWRVJFLCBlLmdldE1lc3NhZ2UoKSwgZSk7CiAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKGUpOwogICAgfQogIH0KCiAgcHJpdmF0ZSBTdHJpbmcgZ2V0U2VsZWN0ZWRQcm9kdWN0KEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICByZXR1cm4gT3B0aW9uYWwub2ZOdWxsYWJsZShyZXF1ZXN0LmdldFBhcmFtZXRlcigiRGlnaXRzIikpCiAgICAgIC5maWx0ZXIoeCAtPiB4LmVxdWFscygiMSIpKS5tYXAoKGZpcnN0KSAtPiAiUHJvZ3JhbW1hYmxlU01TIikub3JFbHNlKCJQcm9ncmFtbWFibGVWb2ljZSIpOwogIH0KfQo=</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/servlet/AssignmentServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb24uc2VydmxldDsKCmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLmNvbW1vbi5Ud2lsaW9BcHBTZXR0aW5nczsKCmltcG9ydCBqYXZheC5pbmplY3QuSW5qZWN0OwppbXBvcnQgamF2YXguaW5qZWN0LlNpbmdsZXRvbjsKaW1wb3J0IGphdmF4Lmpzb24uSnNvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlcXVlc3Q7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXNwb25zZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CgovKioKICogU2VydmxldCBmb3IgVGFzayBhc3NpZ25tZW50cwogKi8KQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgQXNzaWdubWVudFNlcnZsZXQgZXh0ZW5kcyBIdHRwU2VydmxldCB7CgogIHByaXZhdGUgZmluYWwgU3RyaW5nIGRlcXVldWVJbnN0cnVjdGlvbjsKCiAgQEluamVjdAogIHB1YmxpYyBBc3NpZ25tZW50U2VydmxldChUd2lsaW9BcHBTZXR0aW5ncyB0d2lsaW9BcHBTZXR0aW5ncykgewogICAgZGVxdWV1ZUluc3RydWN0aW9uID0gSnNvbi5jcmVhdGVPYmplY3RCdWlsZGVyKCkKICAgICAgLmFkZCgiaW5zdHJ1Y3Rpb24iLCAiZGVxdWV1ZSIpCiAgICAgIC5hZGQoInBvc3Rfd29ya19hY3Rpdml0eV9zaWQiLCB0d2lsaW9BcHBTZXR0aW5ncy5nZXRQb3N0V29ya0FjdGl2aXR5U2lkKCkpCiAgICAgIC5idWlsZCgpLnRvU3RyaW5nKCk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBkb1Bvc3QoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcSwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwKQogICAgdGhyb3dzIFNlcnZsZXRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgIHJlc3Auc2V0Q29udGVudFR5cGUoImFwcGxpY2F0aW9uL2pzb24iKTsKICAgIHJlc3AuZ2V0V3JpdGVyKCkucHJpbnQoZGVxdWV1ZUluc3RydWN0aW9uKTsKICB9Cn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/servlet/EventsServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb24uc2VydmxldDsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5wZXJzaXN0LlRyYW5zYWN0aW9uYWw7CmltcG9ydCBjb20udHdpbGlvLnJlc3QuYXBpLnYyMDEwLmFjY291bnQuTWVzc2FnZUNyZWF0b3I7CmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLmNvbW1vbi5Ud2lsaW9BcHBTZXR0aW5nczsKaW1wb3J0IGNvbS50d2lsaW8udGFza3JvdXRlci5kb21haW4ubW9kZWwuTWlzc2VkQ2FsbDsKaW1wb3J0IGNvbS50d2lsaW8udGFza3JvdXRlci5kb21haW4ucmVwb3NpdG9yeS5NaXNzZWRDYWxsUmVwb3NpdG9yeTsKaW1wb3J0IGNvbS50d2lsaW8udHlwZS5QaG9uZU51bWJlcjsKCmltcG9ydCBqYXZheC5pbmplY3QuSW5qZWN0OwppbXBvcnQgamF2YXguaW5qZWN0LlNpbmdsZXRvbjsKaW1wb3J0IGphdmF4Lmpzb24uSnNvbjsKaW1wb3J0IGphdmF4Lmpzb24uSnNvbk9iamVjdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuU2VydmxldEV4Y2VwdGlvbjsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlcXVlc3Q7CmltcG9ydCBqYXZheC5zZXJ2bGV0Lmh0dHAuSHR0cFNlcnZsZXRSZXNwb25zZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0IGphdmEudXRpbC5PcHRpb25hbDsKaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxvZ2dlcjsKCi8qKgogKiBTZXJ2bGV0IGZvciBFdmVudHMgY2FsbGJhY2sgZm9yIG1pc3NlZCBjYWxscwogKi8KQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgRXZlbnRzU2VydmxldCBleHRlbmRzIEh0dHBTZXJ2bGV0IHsKCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIExFQVZFX01TRyA9ICJTb3JyeSwgQWxsIGFnZW50cyBhcmUgYnVzeS4gUGxlYXNlIGxlYXZlIGEgbWVzc2FnZS4gIgogICAgKyAiV2Ugd2lsbCBjYWxsIHlvdSBhcyBzb29uIGFzIHBvc3NpYmxlIjsKCiAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIE9GRkxJTkVfTVNHID0gIllvdXIgc3RhdHVzIGhhcyBjaGFuZ2VkIHRvIE9mZmxpbmUuICIKICAgICsgIlJlcGx5IHdpdGggXCJPblwiIHRvIGdldCBiYWNrIE9ubGluZSI7CgogIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0TG9nZ2VyKEV2ZW50c1NlcnZsZXQuY2xhc3MuZ2V0TmFtZSgpKTsKCiAgcHJpdmF0ZSBmaW5hbCBUd2lsaW9BcHBTZXR0aW5ncyB0d2lsaW9TZXR0aW5nczsKCiAgcHJpdmF0ZSBmaW5hbCBNaXNzZWRDYWxsUmVwb3NpdG9yeSBtaXNzZWRDYWxsUmVwb3NpdG9yeTsKCiAgQEluamVjdAogIHB1YmxpYyBFdmVudHNTZXJ2bGV0KFR3aWxpb0FwcFNldHRpbmdzIHR3aWxpb1NldHRpbmdzLAogICAgICAgICAgICAgICAgICAgICAgIE1pc3NlZENhbGxSZXBvc2l0b3J5IG1pc3NlZENhbGxSZXBvc2l0b3J5KSB7CiAgICB0aGlzLnR3aWxpb1NldHRpbmdzID0gdHdpbGlvU2V0dGluZ3M7CiAgICB0aGlzLm1pc3NlZENhbGxSZXBvc2l0b3J5ID0gbWlzc2VkQ2FsbFJlcG9zaXRvcnk7CiAgfQoKICBAT3ZlcnJpZGUKICBwdWJsaWMgdm9pZCBkb1Bvc3QoSHR0cFNlcnZsZXRSZXF1ZXN0IHJlcSwgSHR0cFNlcnZsZXRSZXNwb25zZSByZXNwKSB0aHJvd3MgU2VydmxldEV4Y2VwdGlvbiwKICAgIElPRXhjZXB0aW9uIHsKICAgIE9wdGlvbmFsLm9mTnVsbGFibGUocmVxLmdldFBhcmFtZXRlcigiRXZlbnRUeXBlIikpCiAgICAgIC5pZlByZXNlbnQoZXZlbnROYW1lIC0+IHsKICAgICAgICBzd2l0Y2ggKGV2ZW50TmFtZSkgewogICAgICAgICAgY2FzZSAid29ya2Zsb3cudGltZW91dCI6CiAgICAgICAgICBjYXNlICJ0YXNrLmNhbmNlbGVkIjoKICAgICAgICAgICAgcGFyc2VBdHRyaWJ1dGVzKCJUYXNrQXR0cmlidXRlcyIsIHJlcSkKICAgICAgICAgICAgICAuaWZQcmVzZW50KHRoaXM6OmFkZE1pc3NpbmdDYWxsQW5kTGVhdmVNZXNzYWdlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJ3b3JrZXIuYWN0aXZpdHkudXBkYXRlIjoKICAgICAgICAgICAgT3B0aW9uYWwub2ZOdWxsYWJsZShyZXEuZ2V0UGFyYW1ldGVyKCJXb3JrZXJBY3Rpdml0eU5hbWUiKSkKICAgICAgICAgICAgICAuZmlsdGVyKCJPZmZsaW5lIjo6ZXF1YWxzKQogICAgICAgICAgICAgIC5pZlByZXNlbnQob2ZmbGluZUV2ZW50IC0+IHsKICAgICAgICAgICAgICAgIHBhcnNlQXR0cmlidXRlcygiV29ya2VyQXR0cmlidXRlcyIsIHJlcSkKICAgICAgICAgICAgICAgICAgLmlmUHJlc2VudCh0aGlzOjpub3RpZnlPZmZsaW5lU3RhdHVzVG9Xb3JrZXIpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgfQogICAgICB9KTsKICB9CgogIHByaXZhdGUgT3B0aW9uYWw8SnNvbk9iamVjdD4gcGFyc2VBdHRyaWJ1dGVzKFN0cmluZyBwYXJhbWV0ZXIsIEh0dHBTZXJ2bGV0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICByZXR1cm4gT3B0aW9uYWwub2ZOdWxsYWJsZShyZXF1ZXN0LmdldFBhcmFtZXRlcihwYXJhbWV0ZXIpKQogICAgICAubWFwKGpzb25SZXF1ZXN0IC0+IEpzb24uY3JlYXRlUmVhZGVyKG5ldyBTdHJpbmdSZWFkZXIoanNvblJlcXVlc3QpKS5yZWFkT2JqZWN0KCkpOwogIH0KCiAgQFRyYW5zYWN0aW9uYWwKICBwcml2YXRlIHZvaWQgYWRkTWlzc2luZ0NhbGxBbmRMZWF2ZU1lc3NhZ2UoSnNvbk9iamVjdCB0YXNrQXR0cmlidXRlc0pzb24pIHsKICAgIFN0cmluZyBwaG9uZU51bWJlciA9IHRhc2tBdHRyaWJ1dGVzSnNvbi5nZXRTdHJpbmcoImZyb20iKTsKICAgIFN0cmluZyBzZWxlY3RlZFByb2R1Y3QgPSB0YXNrQXR0cmlidXRlc0pzb24uZ2V0U3RyaW5nKCJzZWxlY3RlZF9wcm9kdWN0Iik7CgogICAgTWlzc2VkQ2FsbCBtaXNzZWRDYWxsID0gbmV3IE1pc3NlZENhbGwocGhvbmVOdW1iZXIsIHNlbGVjdGVkUHJvZHVjdCk7CiAgICBtaXNzZWRDYWxsUmVwb3NpdG9yeS5hZGQobWlzc2VkQ2FsbCk7CiAgICBMT0cuaW5mbygiQWRkZWQgTWlzc2luZyBDYWxsOiAiICsgbWlzc2VkQ2FsbCk7CgogICAgU3RyaW5nIGNhbGxTaWQgPSB0YXNrQXR0cmlidXRlc0pzb24uZ2V0U3RyaW5nKCJjYWxsX3NpZCIpOwogICAgdHdpbGlvU2V0dGluZ3MucmVkaXJlY3RUb1ZvaWNlTWFpbChjYWxsU2lkLCBMRUFWRV9NU0cpOwogIH0KCiAgcHJpdmF0ZSB2b2lkIG5vdGlmeU9mZmxpbmVTdGF0dXNUb1dvcmtlcihKc29uT2JqZWN0IHdvcmtlckF0dHJpYnV0ZXNKc29uKSB7CiAgICBTdHJpbmcgd29ya2VyUGhvbmUgPSB3b3JrZXJBdHRyaWJ1dGVzSnNvbi5nZXRTdHJpbmcoImNvbnRhY3RfdXJpIik7CiAgICBuZXcgTWVzc2FnZUNyZWF0b3IoCiAgICAgIG5ldyBQaG9uZU51bWJlcih3b3JrZXJQaG9uZSksCiAgICAgIG5ldyBQaG9uZU51bWJlcih0d2lsaW9TZXR0aW5ncy5nZXRQaG9uZU51bWJlcigpLnRvU3RyaW5nKCkpLAogICAgICBPRkZMSU5FX01TRwogICAgKS5leGVjdXRlKCk7CgogIH0KCn0K</textarea>
<textarea class="saurus-file" data-file="src/main/java/com/twilio/taskrouter/application/servlet/MessageServlet.java" data-mode="java">cGFja2FnZSBjb20udHdpbGlvLnRhc2tyb3V0ZXIuYXBwbGljYXRpb24uc2VydmxldDsKCmltcG9ydCBjb20uZ29vZ2xlLmluamVjdC5TaW5nbGV0b247CmltcG9ydCBjb20udHdpbGlvLnRhc2tyb3V0ZXIuZG9tYWluLm1vZGVsLldvcmtzcGFjZUZhY2FkZTsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuU21zOwppbXBvcnQgY29tLnR3aWxpby50d2ltbC5Ud2lNTEV4Y2VwdGlvbjsKaW1wb3J0IGNvbS50d2lsaW8udHdpbWwuVm9pY2VSZXNwb25zZTsKCmltcG9ydCBqYXZheC5pbmplY3QuSW5qZWN0OwppbXBvcnQgamF2YXguc2VydmxldC5TZXJ2bGV0RXhjZXB0aW9uOwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0OwppbXBvcnQgamF2YXguc2VydmxldC5odHRwLkh0dHBTZXJ2bGV0UmVxdWVzdDsKaW1wb3J0IGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2VydmxldFJlc3BvbnNlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5PcHRpb25hbDsKaW1wb3J0IGphdmEudXRpbC5sb2dnaW5nLkxldmVsOwppbXBvcnQgamF2YS51dGlsLmxvZ2dpbmcuTG9nZ2VyOwoKLyoqCiAqIEhhbmRsZXMgdGhlIG1lc3NhZ2VzIHNlbnQgYnkgd29ya2VycyBmb3IgYWN0aXZhdGUvZGVhY3RpdmF0ZQogKiB0aGVtc2VsdmVzIGZvciByZWNlaXZpbmcgY2FsbHMgZnJvbSB1c2VycwogKi8KQFNpbmdsZXRvbgpwdWJsaWMgY2xhc3MgTWVzc2FnZVNlcnZsZXQgZXh0ZW5kcyBIdHRwU2VydmxldCB7CgogIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0TG9nZ2VyKE1lc3NhZ2VTZXJ2bGV0LmNsYXNzLmdldE5hbWUoKSk7CgogIHByaXZhdGUgZmluYWwgV29ya3NwYWNlRmFjYWRlIHdvcmtzcGFjZTsKCiAgQEluamVjdAogIHB1YmxpYyBNZXNzYWdlU2VydmxldChXb3Jrc3BhY2VGYWNhZGUgd29ya3NwYWNlKSB7CiAgICB0aGlzLndvcmtzcGFjZSA9IHdvcmtzcGFjZTsKICB9CgogIEBPdmVycmlkZQogIHByb3RlY3RlZCB2b2lkIGRvUG9zdChIdHRwU2VydmxldFJlcXVlc3QgcmVxLCBIdHRwU2VydmxldFJlc3BvbnNlIHJlc3ApCiAgICB0aHJvd3MgU2VydmxldEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgZmluYWwgVm9pY2VSZXNwb25zZSB0d2ltbFJlc3BvbnNlOwogICAgZmluYWwgU3RyaW5nIG5ld1N0YXR1cyA9IGdldE5ld1dvcmtlclN0YXR1cyhyZXEpOwogICAgZmluYWwgU3RyaW5nIHdvcmtlclBob25lID0gcmVxLmdldFBhcmFtZXRlcigiRnJvbSIpOwoKICAgIHRyeSB7CiAgICAgIFNtcyByZXNwb25zZVNtcyA9IHdvcmtzcGFjZS5maW5kV29ya2VyQnlQaG9uZSh3b3JrZXJQaG9uZSkubWFwKHdvcmtlciAtPiB7CiAgICAgICAgd29ya3NwYWNlLnVwZGF0ZVdvcmtlclN0YXR1cyh3b3JrZXIsIG5ld1N0YXR1cyk7CiAgICAgICAgcmV0dXJuIG5ldyBTbXMuQnVpbGRlcihTdHJpbmcuZm9ybWF0KCJZb3VyIHN0YXR1cyBoYXMgY2hhbmdlZCB0byAlcyIsIG5ld1N0YXR1cykpLmJ1aWxkKCk7CiAgICAgIH0pLm9yRWxzZUdldCgoKSAtPiBuZXcgU21zLkJ1aWxkZXIoIllvdSBhcmUgbm90IGEgdmFsaWQgd29ya2VyIikuYnVpbGQoKSk7CgogICAgICB0d2ltbFJlc3BvbnNlID0gbmV3IFZvaWNlUmVzcG9uc2UuQnVpbGRlcigpLnNtcyhyZXNwb25zZVNtcykuYnVpbGQoKTsKICAgICAgcmVzcC5zZXRDb250ZW50VHlwZSgiYXBwbGljYXRpb24veG1sIik7CiAgICAgIHJlc3AuZ2V0V3JpdGVyKCkucHJpbnQodHdpbWxSZXNwb25zZS50b1htbCgpKTsKCiAgICB9IGNhdGNoIChUd2lNTEV4Y2VwdGlvbiBlKSB7CiAgICAgIExPRy5sb2coTGV2ZWwuU0VWRVJFLCAiRXJyb3Igd2hpbGUgcHJvdmlkaW5nIGFuc3dlciB0byBhIHdvcmtlcnMnIHNtcyIsIGUpOwogICAgfQoKICB9CgogIHByaXZhdGUgU3RyaW5nIGdldE5ld1dvcmtlclN0YXR1cyhIdHRwU2VydmxldFJlcXVlc3QgcmVxdWVzdCkgewogICAgcmV0dXJuIE9wdGlvbmFsLm9mTnVsbGFibGUocmVxdWVzdC5nZXRQYXJhbWV0ZXIoIkJvZHkiKSkKICAgICAgLmZpbHRlcih4IC0+IHguZXF1YWxzKCJvZmYiKSkubWFwKChmaXJzdCkgLT4gIk9mZmxpbmUiKS5vckVsc2UoIklkbGUiKTsKICB9Cgp9Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div><a href="https://github.com/TwilioDevEd/task-router-servlets" target="_blank" class="explorer-get-code"> <i class="fa fa-lg fa-github-square"> </i>View Code on GitHub</a></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>